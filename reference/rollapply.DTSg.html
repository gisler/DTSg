<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Rolling window function — rollapply.DTSg • DTSg</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Rolling window function — rollapply.DTSg"><meta property="og:description" content="Applies an arbitrary function to a rolling window of selected columns of a
DTSg object with recognised periodicity."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DTSg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/a_basicUsage.html">A. Basic usage</a>
    </li>
    <li>
      <a href="../articles/b_advancedUsage.html">B. Advanced usage</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/gisler/DTSg/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Rolling window function</h1>
    <small class="dont-index">Source: <a href="https://github.com/gisler/DTSg/blob/HEAD/R/Swrappers.R" class="external-link"><code>R/Swrappers.R</code></a></small>
    <div class="hidden name"><code>rollapply.DTSg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Applies an arbitrary function to a rolling window of selected columns of a
<code><a href="DTSg.html">DTSg</a></code> object with recognised periodicity.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for DTSg</span></span>
<span><span class="fu">rollapply</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">fun</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  cols <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">cols</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span><span class="op">[</span><span class="fl">1L</span><span class="op">]</span>,</span>
<span>  before <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  after <span class="op">=</span> <span class="va">before</span>,</span>
<span>  weights <span class="op">=</span> <span class="st">"inverseDistance"</span>,</span>
<span>  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>power <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  resultCols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  suffix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  helpers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  memoryOverCPU <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  clone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"DTSgClone"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A <code><a href="DTSg.html">DTSg</a></code> object (S3 method only).</p></dd>


<dt>fun</dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/function.html" class="external-link">function</a></code>. Its return value must be of length one.</p></dd>


<dt>...</dt>
<dd><p>Further arguments passed on to <code>fun</code>.</p></dd>


<dt>cols</dt>
<dd><p>A character vector specifying the columns whose rolling window
<code>fun</code> shall be applied to. Another possibility is a character string
containing either comma separated column names, for example, <code>"x,y,z"</code>, or
the start and end column separated by a colon, for example, <code>"x:z"</code>.</p></dd>


<dt>before</dt>
<dd><p>An integerish value specifying the size of the window in time
steps before the “center” of the rolling window.</p></dd>


<dt>after</dt>
<dd><p>An integerish value specifying the size of the window in time
steps after the “center” of the rolling window.</p></dd>


<dt>weights</dt>
<dd><p>A character string specifying the method applied to calculate
the weights handed over to <code>fun</code>. These are useful for functions like
<code><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></code>. See corresponding section for further information.</p></dd>


<dt>parameters</dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> specifying parameters for the weight calculation
method. See corresponding section for further information.</p></dd>


<dt>resultCols</dt>
<dd><p>An optional character vector of the same length as <code>cols</code>
specifying the column names for the return values of <code>fun</code>. Another
possibility is a character string containing comma separated column names,
for example, <code>"x,y,z"</code>. Non-existing columns are added and existing columns
are overwritten. Columns are matched element-wise between <code>cols</code> and
<code>resultCols</code>.</p></dd>


<dt>suffix</dt>
<dd><p>An optional character string. The return values of <code>fun</code> are
added as new columns with names consisting of the columns specified in
<code>cols</code> and this suffix. Existing columns are never overwritten. Only used
when <code>resultCols</code> is not specified.</p></dd>


<dt>helpers</dt>
<dd><p>A logical specifying if helper data shall be handed over to
<code>fun</code>. See corresponding section for further information.</p></dd>


<dt>memoryOverCPU</dt>
<dd><p>A logical specifying if memory usage shall be preferred
over CPU usage for this method call. The former is generally faster for
smaller windows and shorter time series, the latter for bigger windows and
longer time series or might even be the only one which works depending on
the available hardware.</p></dd>


<dt>clone</dt>
<dd><p>A logical specifying if the object shall be modified in place or
if a deep clone (copy) shall be made beforehand.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns a <code><a href="DTSg.html">DTSg</a></code> object.</p>
    </div>
    <div id="weights">
    <h2>Weights</h2>
    

<p>Currently, only one method to calculate weights is supported:
<code>"inverseDistance"</code>. The distance \(d\) of the “center” is one and
each time step further away from the “center” adds one to it. So, for
example, the distance of a timestamp three steps away from the
“center” is four. Additionally, the calculation of the weights accepts
a power parameter \(p\) as a named element of a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> provided through
the <code>parameters</code> argument: \(\frac{1}{d^p}\).</p>
    </div>
    <div id="helper-data">
    <h2>Helper data</h2>
    

<p>In addition to the <code>...</code> argument, this method optionally hands over the
weights as a numeric vector (<code>w</code> argument) and a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> argument with
helper data called <code>.helpers</code> to <code>fun</code>. This <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> contains the following
elements:</p><ul><li><p><em>before:</em> Same as the <code>before</code> argument.</p></li>
<li><p><em>after:</em> Same as the <code>after</code> argument.</p></li>
<li><p><em>windowSize:</em> Size of the rolling window (<code>before + 1L + after</code>).</p></li>
<li><p><em>centerIndex:</em> Index of the “center” of the rolling window
(<code>before + 1L</code>).</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="cols.DTSg.html">cols</a></code>, <code><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># new DTSg object</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="DTSg.html">DTSg</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>values <span class="op">=</span> <span class="va">flow</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate a moving average</span></span></span>
<span class="r-in"><span><span class="co">## R6 method</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">$</span><span class="fu">rollapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fun <span class="op">=</span> <span class="va">mean</span>,</span></span>
<span class="r-in"><span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  before <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  after <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Values:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        .dateTime    flow</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           &lt;POSc&gt;   &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1: 2007-01-01  9.2550</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2: 2007-01-02  9.1275</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3: 2007-01-03  9.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4: 2007-01-04  8.7720</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5: 2007-01-05  8.5710</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2188: 2012-12-27 28.9860</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2189: 2012-12-28 25.3200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2190: 2012-12-29 22.8810</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2191: 2012-12-30 21.9300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2192: 2012-12-31 19.8900</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Aggregated:     FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Regular:        TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Periodicity:    Time difference of 1 days</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Missing values: explicit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time zone:      UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Timestamps:     2192</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## S3 method</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print.DTSg.html">print</a></span><span class="op">(</span><span class="fu">rollapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">x</span>,</span></span>
<span class="r-in"><span>  fun <span class="op">=</span> <span class="va">mean</span>,</span></span>
<span class="r-in"><span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  before <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  after <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Values:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        .dateTime    flow</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           &lt;POSc&gt;   &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1: 2007-01-01  9.2550</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2: 2007-01-02  9.1275</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3: 2007-01-03  9.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4: 2007-01-04  8.7720</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5: 2007-01-05  8.5710</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2188: 2012-12-27 28.9860</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2189: 2012-12-28 25.3200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2190: 2012-12-29 22.8810</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2191: 2012-12-30 21.9300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2192: 2012-12-31 19.8900</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Aggregated:     FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Regular:        TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Periodicity:    Time difference of 1 days</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Missing values: explicit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time zone:      UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Timestamps:     2192</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Gerold Hepp.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

